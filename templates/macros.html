{% extends "base.html" %}

{% block title %}Macros Calculator - CalcHub{% endblock %}

{% block content %}
<div class="calculator-page">
    <h1>üçé Macros Calculator</h1>
    <div class="calc-container">
        <div class="input-group">
            <label>Weight</label>
            <input type="number" id="weight" placeholder="Enter weight">
        </div>
        <div class="input-group">
            <label>Weight Unit</label>
            <select id="weightUnit">
                <option value="kg">Kilograms (kg)</option>
                <option value="lbs">Pounds (lbs)</option>
            </select>
        </div>
        <div class="input-group">
            <label>Height (cm)</label>
            <input type="number" id="height" placeholder="Enter height in cm">
        </div>
        <div class="input-group">
            <label>Age</label>
            <input type="number" id="age" placeholder="Enter age">
        </div>
        <div class="input-group">
            <label>Gender</label>
            <select id="gender">
                <option value="male">Male</option>
                <option value="female">Female</option>
            </select>
        </div>
        <div class="input-group">
            <label>Activity Level</label>
            <select id="activityLevel">
                <option value="sedentary">Sedentary (little or no exercise)</option>
                <option value="light">Light (exercise 1-3 days/week)</option>
                <option value="moderate">Moderate (exercise 3-5 days/week)</option>
                <option value="active">Active (exercise 6-7 days/week)</option>
                <option value="very_active">Very Active (intense exercise daily)</option>
            </select>
        </div>
        <div class="input-group">
            <label>Goal</label>
            <select id="goal">
                <option value="lose_weight">Lose Weight</option>
                <option value="maintain">Maintain Weight</option>
                <option value="gain_muscle">Gain Muscle</option>
            </select>
        </div>
        <button class="btn-primary" onclick="calculateMacros()">Calculate Macros</button>

        <div id="result" class="result-box" style="display:none;">
            <h2>Your Daily Macros</h2>
            <div class="info-card">
                <h3 style="color: #667eea;">Target Calories: <span id="targetCalories"></span></h3>
                <p><strong>BMR:</strong> <span id="bmr"></span> calories/day</p>
                <p><strong>TDEE:</strong> <span id="tdee"></span> calories/day</p>
            </div>

            <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 1.5rem 0;">
                <div class="info-card"
                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h3>ü•© Protein</h3>
                    <h2 id="proteinGrams"></h2>
                    <p id="proteinCals"></p>
                    <p id="proteinPercent"></p>
                    <p style="font-size: 0.9em;"><span id="proteinPerKg"></span> g/kg bodyweight</p>
                </div>
                <div class="info-card"
                    style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
                    <h3>üçû Carbs</h3>
                    <h2 id="carbsGrams"></h2>
                    <p id="carbsCals"></p>
                    <p id="carbsPercent"></p>
                </div>
                <div class="info-card"
                    style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white;">
                    <h3>ü•ë Fats</h3>
                    <h2 id="fatsGrams"></h2>
                    <p id="fatsCals"></p>
                    <p id="fatsPercent"></p>
                </div>
            </div>

            <div class="info-card">
                <h3>Per Meal Breakdown (3 meals)</h3>
                <p><strong>Protein:</strong> <span id="mealProtein"></span>g</p>
                <p><strong>Carbs:</strong> <span id="mealCarbs"></span>g</p>
                <p><strong>Fats:</strong> <span id="mealFats"></span>g</p>
                <p><strong>Calories:</strong> <span id="mealCalories"></span></p>
            </div>

            <div class="info-card">
                <h3>üí° Recommendations</h3>
                <ul id="recommendations" style="text-align: left; padding-left: 1.5rem;"></ul>
            </div>
        </div>
    </div>
</div>

<script>
    async function calculateMacros() {
        const weight = document.getElementById('weight').value;
        const height = document.getElementById('height').value;
        const age = document.getElementById('age').value;
        const gender = document.getElementById('gender').value;
        const activityLevel = document.getElementById('activityLevel').value;
        const goal = document.getElementById('goal').value;
        const weightUnit = document.getElementById('weightUnit').value;

        if (!weight || !height || !age) {
            alert('Please fill in all fields');
            return;
        }

        const response = await fetch('/api/macros', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ weight, height, age, gender, activity_level: activityLevel, goal, weight_unit: weightUnit })
        });

        const data = await response.json();

        document.getElementById('bmr').textContent = data.bmr;
        document.getElementById('tdee').textContent = data.tdee;
        document.getElementById('targetCalories').textContent = data.target_calories + ' cal/day';

        document.getElementById('proteinGrams').textContent = data.macros.protein.grams + 'g';
        document.getElementById('proteinCals').textContent = data.macros.protein.calories + ' calories';
        document.getElementById('proteinPercent').textContent = data.macros.protein.percentage + '%';
        document.getElementById('proteinPerKg').textContent = data.macros.protein.per_kg_bodyweight;

        document.getElementById('carbsGrams').textContent = data.macros.carbs.grams + 'g';
        document.getElementById('carbsCals').textContent = data.macros.carbs.calories + ' calories';
        document.getElementById('carbsPercent').textContent = data.macros.carbs.percentage + '%';

        document.getElementById('fatsGrams').textContent = data.macros.fats.grams + 'g';
        document.getElementById('fatsCals').textContent = data.macros.fats.calories + ' calories';
        document.getElementById('fatsPercent').textContent = data.macros.fats.percentage + '%';

        document.getElementById('mealProtein').textContent = data.meal_breakdown.per_meal.protein_grams;
        document.getElementById('mealCarbs').textContent = data.meal_breakdown.per_meal.carbs_grams;
        document.getElementById('mealFats').textContent = data.meal_breakdown.per_meal.fats_grams;
        document.getElementById('mealCalories').textContent = data.meal_breakdown.per_meal.calories;

        const recList = document.getElementById('recommendations');
        recList.innerHTML = '';
        data.recommendations.forEach(rec => {
            recList.innerHTML += `<li>${rec}</li>`;
        });

        document.getElementById('result').style.display = 'block';
    }
</script>
{% endblock %}